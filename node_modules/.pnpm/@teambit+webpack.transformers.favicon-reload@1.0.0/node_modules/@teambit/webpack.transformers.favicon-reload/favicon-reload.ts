import type {
  WebpackConfigMutator,
  WebpackConfigTransformContext,
} from '@teambit/webpack';

/**
 * force the browser to reload the favicon on every build.
 * @param filename the favicon filename. default to '/favicon.svg'.
 * It should start with '/'.
 */
export function faviconReload(filename?: string) {
  return (
    config: WebpackConfigMutator,
    context: WebpackConfigTransformContext
  ) => {
    if (context?.mode === 'prod') return config;
    config.removeElementFromHtmlTemplate(
      `<link rel="icon" href="${filename || '/favicon.svg'}">`
    );
    config.addElementToHtmlTemplate({
      tag: 'link',
      parent: 'head',
      position: 'append',
      attributes: {
        rel: 'icon',
        href: `${`${filename || '/favicon.svg'}?v=${Date.now()}`}`,
      },
    });
    return config;
  };
}
